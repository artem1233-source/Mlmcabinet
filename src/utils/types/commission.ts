// üí∞ –¢–ò–ü–´ –î–õ–Ø –°–ò–°–¢–ï–ú–´ –ö–û–ú–ò–°–°–ò–ô

/**
 * –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–∏—Å—Å–∏–π –¥–ª—è –æ–¥–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è MLM
 */
export interface CommissionLevel {
  L0?: number; // –î–ª—è –≥–æ—Å—Ç–µ–≤—ã—Ö –ø—Ä–æ–¥–∞–∂ (–ø—Ä–æ–¥–∞–≤–µ—Ü)
  L1?: number; // 1-—è –ª–∏–Ω–∏—è (–ø—Ä—è–º–æ–π —Å–ø–æ–Ω—Å–æ—Ä)
  L2?: number; // 2-—è –ª–∏–Ω–∏—è
  L3?: number; // 3-—è –ª–∏–Ω–∏—è
  L4?: number; // 4-—è –ª–∏–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  L5?: number; // 5-—è –ª–∏–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
}

/**
 * –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–º–∏—Å—Å–∏–π –ø—Ä–æ–¥—É–∫—Ç–∞
 */
export interface ProductCommission {
  guest: CommissionLevel;   // –ö–æ–º–∏—Å—Å–∏–∏ –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ –≥–æ—Å—Ç—é
  partner: CommissionLevel; // –ö–æ–º–∏—Å—Å–∏–∏ –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ –ø–∞—Ä—Ç–Ω—ë—Ä—É
}

/**
 * –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –ø—Ä–æ–¥—É–∫—Ç–∞ —Å –∫–æ–º–∏—Å—Å–∏—è–º–∏
 */
export interface ProductWithCommission {
  id: string | number;
  sku: string;
  –Ω–∞–∑–≤–∞–Ω–∏–µ?: string;
  name?: string;
  –æ–ø–∏—Å–∞–Ω–∏–µ?: string;
  description?: string;
  
  // –¶–µ–Ω—ã
  retail_price?: number;      // –†–æ–∑–Ω–∏—á–Ω–∞—è —Ü–µ–Ω–∞ (–¥–ª—è –≥–æ—Å—Ç–µ–π)
  partner_price?: number;     // –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è —Ü–µ–Ω–∞ (–¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤)
  —Ä–æ–∑–Ω–∏—á–Ω–∞—è–¶–µ–Ω–∞?: number;     // –ê–ª–∏–∞—Å –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
  –ø–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è–¶–µ–Ω–∞?: number;   // –ê–ª–∏–∞—Å –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
  
  // –ö–æ–º–∏—Å—Å–∏–∏ (–Ω–æ–≤–æ–µ!)
  commission?: ProductCommission;
  
  // –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
  –∫–∞—Ç–µ–≥–æ—Ä–∏—è?: string;
  –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ?: string;
  –∞–∫—Ç–∏–≤–µ–Ω?: boolean;
  –≤–ù–∞–ª–∏—á–∏–∏?: boolean;
  [key: string]: any; // –î–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏
}

/**
 * –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏ (—Ç–µ, —á—Ç–æ —Å–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
 * 
 * ‚úÖ –í–ê–ñ–ù–û: –î–ª—è –≥–æ—Å—Ç–µ–≤—ã—Ö –ø—Ä–æ–¥–∞–∂ —Ç–µ–ø–µ—Ä—å —Ç–æ–∂–µ –µ—Å—Ç—å L1/L2/L3!
 * - L0 –∏–¥—ë—Ç –ø—Ä–æ–¥–∞–≤—Ü—É (referrer)
 * - L1/L2/L3 –∏–¥—É—Ç —Å–ø–æ–Ω—Å–æ—Ä–∞–º –ø—Ä–æ–¥–∞–≤—Ü–∞ (upline)
 */
export const DEFAULT_COMMISSIONS: Record<string, ProductCommission> = {
  'H2-1': {
    guest: { 
      L0: 1600,  // –ü—Ä–æ–¥–∞–≤–µ—Ü
      L1: 900,   // –°–ø–æ–Ω—Å–æ—Ä –ø—Ä–æ–¥–∞–≤—Ü–∞ (1-—è –ª–∏–Ω–∏—è)
      L2: 500,   // –°–ø–æ–Ω—Å–æ—Ä –ø—Ä–æ–¥–∞–≤—Ü–∞ (2-—è –ª–∏–Ω–∏—è)
      L3: 200    // –°–ø–æ–Ω—Å–æ—Ä –ø—Ä–æ–¥–∞–≤—Ü–∞ (3-—è –ª–∏–Ω–∏—è)
    },
    partner: { L1: 900, L2: 500, L3: 200 }
  },
  'H2-3': {
    guest: { 
      L0: 4500,   // –ü—Ä–æ–¥–∞–≤–µ—Ü
      L1: 1800,   // –°–ø–æ–Ω—Å–æ—Ä –ø—Ä–æ–¥–∞–≤—Ü–∞ (1-—è –ª–∏–Ω–∏—è)
      L2: 1200,   // –°–ø–æ–Ω—Å–æ—Ä –ø—Ä–æ–¥–∞–≤—Ü–∞ (2-—è –ª–∏–Ω–∏—è)
      L3: 600     // –°–ø–æ–Ω—Å–æ—Ä –ø—Ä–æ–¥–∞–≤—Ü–∞ (3-—è –ª–∏–Ω–∏—è)
    },
    partner: { L1: 1800, L2: 1200, L3: 600 }
  }
};

/**
 * –ü–æ–ª—É—á–∏—Ç—å –∫–æ–º–∏—Å—Å–∏–∏ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞
 * –ï—Å–ª–∏ –∫–æ–º–∏—Å—Å–∏–∏ –∑–∞–¥–∞–Ω—ã –≤ –ø—Ä–æ–¥—É–∫—Ç–µ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Ö
 * –ò–Ω–∞—á–µ - –±–µ—Ä—ë—Ç –∏–∑ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –ø–æ SKU
 */
export function getProductCommissions(product: ProductWithCommission | string): ProductCommission {
  // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω SKU (—Å—Ç—Ä–æ–∫–∞)
  if (typeof product === 'string') {
    return DEFAULT_COMMISSIONS[product] || DEFAULT_COMMISSIONS['H2-1'];
  }
  
  // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –æ–±—ä–µ–∫—Ç –ø—Ä–æ–¥—É–∫—Ç–∞
  if (product.commission) {
    return product.commission;
  }
  
  // Fallback –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏ –ø–æ SKU
  return DEFAULT_COMMISSIONS[product.sku] || DEFAULT_COMMISSIONS['H2-1'];
}

/**
 * –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–º–∏—Å—Å–∏–π
 */
export function validateCommission(commission: ProductCommission): { valid: boolean; error?: string } {
  if (!commission.guest && !commission.partner) {
    return { valid: false, error: '–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–¥–∞–Ω–∞ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–∏—Å—Å–∏–π (guest –∏–ª–∏ partner)' };
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è - –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞
  const checkLevels = (levels: CommissionLevel) => {
    return Object.values(levels).every(v => typeof v === 'number' && v >= 0);
  };
  
  if (commission.guest && !checkLevels(commission.guest)) {
    return { valid: false, error: '–ö–æ–º–∏—Å—Å–∏–∏ –¥–ª—è –≥–æ—Å—Ç–µ–π –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏' };
  }
  
  if (commission.partner && !checkLevels(commission.partner)) {
    return { valid: false, error: '–ö–æ–º–∏—Å—Å–∏–∏ –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏' };
  }
  
  return { valid: true };
}
