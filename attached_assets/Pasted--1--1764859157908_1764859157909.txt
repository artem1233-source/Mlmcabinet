Нужно доработать функционал «Продать гостю» для партнёрского кабинета.

Задачи две:
1) Сделать аккуратное компактное окно продажи.
2) Починить математику комиссий при продаже гостю, чтобы выплаты корректно уходили по линиям и отображались в доходах.

Пожалуйста, работай по шагам: сначала анализ, потом точечные правки. Не делай глобальный рефакторинг.

--------------------------------
ШАГ 1. АНАЛИЗ БЕЗ ИЗМЕНЕНИЙ
--------------------------------

1. Найди весь фронтенд-код, связанный с кнопкой «Продать гостю»:
   - компонент каталога, где есть эта кнопка;
   - компонент модального окна (форма, которая сейчас вылезает на весь экран);
   - обработчик отправки формы (что вызывается при подтверждении продажи).

2. Найди серверную часть, которая обрабатывает продажу гостю:
   - endpoint / функцию в src/supabase/functions/server/index.tsx (или других server-файлах),
   - где создаётся заказ для гостя,
   - где считаются комиссии и создаются записи в earnings.

3. Опиши коротко:
   - какой компонент рисует окно;
   - какой endpoint вызывается;
   - какие именно поля сейчас записываются в:
     - order (включая payouts / комиссии);
     - earnings (userId, amount, level/уровень);
   - почему при продаже гостю от пользователя 008:
     - у самого 008 в разделе «Доходы» я вижу только «Доход за период» и одну транзакцию без разбивки по уровню 0 на 1600 ₽;
     - у его вышестоящих линий вообще нет дохода с этой продажи.

Сделай текстовый отчёт и только после него переходи к изменениям.

--------------------------------
ШАГ 2. ПОЧИНКА МАТЕМАТИКИ КОМИССИЙ «ПРОДАТЬ ГОСТЮ»
--------------------------------

Цель: продажа гостю должна использовать ту же единую цепочку расчёта, что и остальные заказы:

product.commission → getProductCommissions(product) → calcOrder({ isPartner, sku, referrerId/upline, product }) → order.payouts → earnings.

Сделай так:

1. В серверной функции продажи гостю:
   - обязательно получи объект product с полем commission;
   - вызывай calcOrder с корректными параметрами:
     - isPartner — статус продавца,
     - sku,
     - referrerId / upline — id спонсора, чтобы calcOrder мог построить цепочку до 3 линий;
     - product.
   - результат calcOrder должен содержать:
     - итоговую price,
     - payouts — массив выплат с userId получателя, amount и level (0,1,2,3).

2. При создании заказа:
   - сохрани order.payouts (или аналогичное поле) как основной источник правды;
   - для КАЖДОГО элемента payouts создай отдельную запись в earnings:
     - правильный userId,
     - amount,
     - type = «commission» или аналогичный тип дохода,
     - level:
       - 0 для продавца (тот, кто нажал «Продать гостю»),
       - 1 для 1-й линии,
       - 2 для 2-й,
       - 3 для 3-й.

3. Удали/игнорируй старую логику, которая:
   - использует поля d0/d1/d2/d3,
   - использует локальные хардкоды комиссий (1600/900/500/200 и т.п.) без обращения к product.commission,
   - пишет комиссию напрямую в поля order.комиссии без связи с payouts.

4. Убедись, что API, которое использует компонент Earnings/Доходы, берёт данные именно из earnings и группирует суммы по полю level (0–3).

Ожидаемое поведение на примере:
- продукт с commission для гостевой продажи:
  - L0 = 1600,
  - L1, L2, L3 — согласно настройкам.
- Я, будучи пользователем 008, нажимаю «Продать гостю».
  - В earnings:
    - одна запись с userId = 008, level = 0, amount = 1600;
    - записи для upline 1-й / 2-й / 3-й линии с их уровнями и суммами.
  - В разделе «Доходы» у 008:
    - блок «Уровень 0» показывает 1600 ₽ от этой транзакции.
  - У вышестоящей 1-й линии:
    - блок «Уровень 1» показывает свою комиссию с этой продажи, и есть запись в истории.

Покажи diff по изменённым server-файлам и кратко опиши, как теперь идёт поток данных от клика по кнопке до записей в earnings.

--------------------------------
ШАГ 3. УЛУЧШЕНИЕ UI ОКНА «ПРОДАТЬ ГОСТЮ»
--------------------------------

Сейчас окно слишком большое и выглядит тяжёлым. Нужно сделать компактное модальное окно в стиле остального кабинета.

1. Найди компонент, который сейчас рисует окно «Продать гостю».
2. Переделай его:
   - используй стандартный компонент модального окна/диалога, который уже есть в проекте (Dialog/Modal/Sheet/Card и т.п.);
   - размер:
     - не на весь экран,
     - по центру, с адекватными отступами;
   - структура:
     - заголовок «Продать гостю»;
     - краткий блок с информацией о продукте (название, цена, комиссия продавца);
     - поля для данных гостя (минимально необходимые: имя/email/телефон — ориентируйся на текущую реализацию);
     - кнопки «Отмена» и «Подтвердить».

3. Сохрани стилистику проекта:
   - те же шрифты,
   - скругления,
   - кнопки как в остальных модалках.

В конце:
   - покажи diff по фронтенд-файлам;
   - коротко опиши, как теперь выглядит окно (чтобы было ясно, что оно компактное, а не фуллскрин).