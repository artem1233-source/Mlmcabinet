Нужен точный аудит системы расчёта рангов в проекте Mlmcabinet, без изменений кода.

Что важно:
	1.	Определение ранга (это бизнес-правило, его менять нельзя):
	•	Новый партнёр без структуры (нет детей в дереве) → ранг 0.
	•	Если под партнёром максимальная глубина структуры вглубь = N уровней (число «шагов» вниз по самой длинной ветке), то его ранг = N.
	•	Пример: цепочка A → B → C → D даёт ранги:
	•	D = 0 (нет детей)
	•	C = 1 (под ним только D)
	•	B = 2 (C → D)
	•	A = 3 (B → C → D)
	2.	Нужно:
	•	Найти все места на сервере, где:
	•	считается ранг (rank, ранг, уровень, depth и т.п.),
	•	ранг сохраняется в БД или KV,
	•	ранги пересчитываются (diagnostics / recalculate / admin-эндпоинты).
	•	Найти все места на фронтенде, где используется ранг:
	•	дерево структуры, админ-дерево, страница пользователя, бейдж ранга и любые фильтры по рангу.
	•	Отдельно отметить:
	•	где ранг приходит с сервера и просто показывается,
	•	где ранг пересчитывается на клиенте на основе глубины или каких-то других полей (depth, командa, дети и т.д.),
	•	где есть искусственные правки типа Math.max(1, rank) или подстановка 1, если приходит 0.
	3.	В отчёте хочу увидеть:
	•	Список всех функций/эндпоинтов на бэкенде, которые считают/обновляют ранг, с кратким описанием, что именно они делают.
	•	Список всех React-компонентов/хуков, которые работают с рангом, с пометкой:
	•	«использует серверный rank как есть»
	•	или «клиентский перерасчёт / исправление ранга».
	•	Ваш вывод:
	•	где есть расхождения с бизнес-правилом выше,
	•	где фронтенд может перезаписывать корректный серверный ранг.

Никаких изменений в коде пока не делай — только подробный анализ и список проблемных мест.

⸻

3. Промпт №2 — исправление рангов (Build)

После анализа (и если всё ок по отчёту) включаешь Build + Autonomous Low и даёшь этот промт:

Цель: привести систему рангов к единой логике и убрать любые расхождения между бэкендом и фронтендом.

Бизнес-правило (фиксированное, менять нельзя):
	•	Партнёр без структуры (нет детей в дереве) имеет ранг 0.
	•	Если под партнёром максимальная глубина структуры вглубь = N уровней (количество «шагов» вниз по самой длинной ветке), его ранг = N.
	•	Пример цепочки A → B → C → D:
	•	D = 0, C = 1, B = 2, A = 3.

Требования:
	1.	Бэкенд
	•	Убедиться, что основная функция расчёта ранга (rank_calculator и связанные с ней функции/эндпоинты) реализует именно эту формулу:
	•	нет детей → 0;
	•	есть дети → rank = max(rank детей) + 1.
	•	Проверить все места, где ранг сохраняется в KV/БД или пересчитывается (diagnostics, recalculate-all-ranks и т.п.) и привести их к единой логике.
	•	Убедиться, что при регистрации нового пользователя:
	•	его ранг всегда инициализируется как 0;
	•	кэш ранга (если используется) сразу записывается как 0.
	2.	Фронтенд
	•	Во всех компонентах, где отображается ранг (дерево структуры, админ-дерево, кабинет пользователя, бейдж ранга, фильтры), сделать так, чтобы:
	•	ранг всегда брался из ответа API/серверного поля;
	•	нигде не происходил клиентский перерасчёт по глубине (depth, level, children.length и т.п.).
	•	Удалить/переписать любую логику вида:
	•	Math.max(1, rank)
	•	подстановка 1 при rank = 0
	•	функции вроде calculateCorrectRank, которые пересчитывают ранг на клиенте.
	•	Если фронтенду нужно отображать что-то отдельное (например, «количество уровней в команде»), это должно быть другим полем, не переопределяющим rank.
	3.	Синхронизация и диагностика
	•	Убедиться, что и админ-интерфейс, и личный кабинет пользователя берут одно и то же поле ранга, из одной и той же серверной логики.
	•	При необходимости:
	•	добавить/обновить простой debug-эндпоинт, который по userId возвращает: структуру вниз, ранги детей и итоговый ранг, чтобы можно было вручную проверить несколько пользователей.
	4.	В конце работы:
	•	Показать diff по всем изменённым файлам.
	•	Кратко описать:
	•	какие именно клиентские перерасчёты ранга были удалены;
	•	где теперь считается ранг на сервере и откуда фронтенд его читает;
	•	пару примеров пользователей/цепочек, по которым ты проверил корректность рангов.

Важно: не трогай логику комиссий, выплат и другие бизнес-части, кроме рангов и связанных с ними отображений.