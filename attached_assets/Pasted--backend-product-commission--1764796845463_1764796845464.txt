Задача: сделать backend совместимым с новой моделью комиссий product.commission, не ломая текущую структуру { d0,d1,d2,d3 } и не трогая БД.

Ограничения:
	•	Работай ТОЛЬКО в файле src/supabase/functions/server/index.tsx и, при необходимости, можешь создать один небольшой helper-файл рядом (например, commission_backend.ts).
	•	Не меняй структуру таблиц в БД и типы Supabase.
	•	Не трогай логику рангов, дерева пользователей, смены ID и многократных ID.
	•	Не меняй формат записей earnings, поля d0/d1/d2/d3, order.комиссии, order.платежи.
	•	Делай изменения маленькими шагами и после каждого шага показывай diff.

Текущая ситуация (по отчёту аудита):
	•	Фронтенд использует product.commission (структура guest/partner с уровнями L0/L1/L2/L3…).
	•	Backend в server/index.tsx использует:
	•	локальный productConfig с жёсткими числами 1600/1500/900/600;
	•	поле product.комиссии = { d0,d1,d2,d3 };
	•	функцию calculatePayouts(price, isPartner, sku, upline), которая не вызывает getProductCommissions/calcOrder.

Что нужно сделать на этом шаге:
	1.	Добавить helper-функции конвертации:
	•	Функция, которая принимает product и:
	•	если у product есть поле commission в новой структуре (guest/partner с L0/L1/L2/L3),
конвертирует его в объект { d0,d1,d2,d3 } для текущего backend-кода:
	•	для гостя: L0 → d0, L1 → d1, L2 → d2, L3 → d3 (если каких-то нет — 0);
	•	если commission отсутствует или некорректна — будет использоваться дефолт;
	•	если поля commission нет, возвращает дефолтные комиссии из DEFAULT_COMMISSIONS (если их можно импортировать), либо аккуратную копию дефолтов без жёсткого захардкоженного 1600/1500/900/600.
	•	При необходимости создай отдельный файл helper’а, но следи, чтобы его можно было импортировать из edge-функций (без лишних зависимостей).
	2.	Переписать calculatePayouts:
	•	Убрать использование локального productConfig и жёстких комиссий.
	•	Логика должна быть такой:
	•	загрузить список товаров (как сейчас);
	•	найти product по sku;
	•	получить объект { d0,d1,d2,d3 } через новую helper-функцию:
	•	сначала попытаться на основе product.commission;
	•	если не получилось — использовать дефолт (без хардкодов в теле функции).
	•	дальше использовать только этот объект commissions для расчёта выплат (как сейчас).
	3.	НИЧЕГО не менять в API, сигнатурах функций и полях заказов:
	•	order.комиссии остаётся в прежнем формате { d0,d1,d2,d3 };
	•	order.платежи (payouts) не меняется;
	•	все вызовы calculatePayouts продолжают работать, но теперь получают комиссии из product.commission или дефолтов, а не из жёстких констант.
	4.	В конце:
	•	Покажи diff только по server/index.tsx и, если создан, по helper-файлу.
	•	Кратко опиши:
	•	где именно были убраны хардкоды;
	•	как именно теперь используется product.commission;
	•	как работает fallback, если у товара commission не задан.

Пожалуйста, начни с короткого плана шагов внутри этого файла, затем выполняй шаг 1, покажи diff и дождись моего подтверждения, прежде чем делать шаг 2 и дальше.